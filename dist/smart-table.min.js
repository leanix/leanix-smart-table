/** 
* @version 2.1.1
* @license MIT
*/
!function(e,t){"use strict";e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<nav ng-if="numPages && pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></nav>')}]),e.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400,inputEvent:"input"},select:{mode:"single",selectedClass:"st-selected"},sort:{ascentClass:"st-sort-ascent",descentClass:"st-sort-descent",skipNatural:!1},pipe:{delay:100}}),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(n,a,s,r){function i(e){return e?[].concat(e):[]}function c(){b=i(l(n)),v===!0&&P.pipe()}function o(e,t){if(-1!=t.indexOf(".")){var n=t.split("."),s=n.pop(),r=n.join("."),i=a(r)(e);delete i[s],0==Object.keys(i).length&&o(e,r)}else delete e[t]}var l,u,p,g=r.stTable,f=a(g),m=f.assign,d=s("orderBy"),h=s("filter"),b=i(f(n)),S={sort:{},search:{},pagination:{start:0}},v=!0,P=this;r.stSafeSrc&&(l=a(r.stSafeSrc),n.$watch(function(){var e=l(n);return e?e.length:0},function(e){e!==b.length&&c()}),n.$watch(function(){return l(n)},function(e,t){e!==t&&c()})),this.sortBy=function(t,n){return S.sort.predicate=t,S.sort.reverse=n===!0,e.isFunction(t)?S.sort.functionName=t.name:delete S.sort.functionName,S.pagination.start=0,this.pipe()},this.search=function(t,n){var s=S.search.predicateObject||{},r=n?n:"$";return t=e.isString(t)?t.trim():t,a(r).assign(s,t),t||o(s,r),S.search.predicateObject=s,S.pagination.start=0,this.pipe()},this.pipe=function(){var e,a=S.pagination;u=S.search.predicateObject?h(b,S.search.predicateObject):b,S.sort.predicate&&(u=d(u,S.sort.predicate,S.sort.reverse)),a.number!==t&&(a.numberOfPages=u.length>0?Math.ceil(u.length/a.number):1,a.start=a.start>=u.length?(a.numberOfPages-1)*a.number:a.start,e=u.slice(a.start,a.start+parseInt(a.number))),m(n,e||u)},this.select=function(e,a){var s=i(f(n)),r=s.indexOf(e);-1!==r&&("single"===a?(e.isSelected=e.isSelected!==!0,p&&(p.isSelected=!1),p=e.isSelected===!0?e:t):s[r].isSelected=!s[r].isSelected)},this.slice=function(e,t){return S.pagination.start=e,S.pagination.number=t,this.pipe()},this.tableState=function(){return S},this.getFilteredCollection=function(){return u||b},this.setFilterFunction=function(e){h=s(e)},this.setSortFunction=function(e){d=s(e)},this.preventPipeOnWatch=function(){v=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,n,a){n.stSetFilter&&a.setFilterFunction(n.stSetFilter),n.stSetSort&&a.setSortFunction(n.stSetSort)}}}),e.module("smart-table").directive("stSearch",["stConfig","$timeout","$parse",function(e,t,n){return{require:"^stTable",link:function(a,s,r,i){var c=i,o=null,l=r.stDelay||e.search.delay,u=r.stInputEvent||e.search.inputEvent;r.$observe("stSearch",function(e,t){var n=s[0].value;e!==t&&n&&(i.tableState().search={},c.search(n,e))}),a.$watch(function(){return i.tableState().search},function(e){var t=r.stSearch||"$";e.predicateObject&&n(t)(e.predicateObject)!==s[0].value&&(s[0].value=n(t)(e.predicateObject)||"")},!0),s.bind(u,function(e){e=e.originalEvent||e,null!==o&&t.cancel(o),o=t(function(){c.search(e.target.value,r.stSearch||""),o=null},l)})}}}]),e.module("smart-table").directive("stSelectRow",["stConfig",function(e){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(t,n,a,s){var r=a.stSelectMode||e.select.mode;n.bind("click",function(){t.$apply(function(){s.select(t.row,r)})}),t.$watch("row.isSelected",function(t){t===!0?n.addClass(e.select.selectedClass):n.removeClass(e.select.selectedClass)})}}}]),e.module("smart-table").directive("stSort",["stConfig","$parse",function(n,a){return{restrict:"A",require:"^stTable",link:function(s,r,i,c){function o(){g++,u=e.isFunction(p(s))?p(s):i.stSort,g%3===0&&!!h!=!0?(g=0,c.tableState().sort={},c.tableState().pagination.start=0,c.pipe()):c.sortBy(u,g%2===0)}var l,u=i.stSort,p=a(u),g=0,f=i.stClassAscent||n.sort.ascentClass,m=i.stClassDescent||n.sort.descentClass,d=[f,m],h=i.stSkipNatural!==t?i.stSkipNatural:n.sort.skipNatural;i.stSortDefault&&(l=s.$eval(i.stSortDefault)!==t?s.$eval(i.stSortDefault):i.stSortDefault),r.bind("click",function(){u&&s.$apply(o)}),l&&(g="reverse"===l?1:0,o()),s.$watch(function(){return c.tableState().sort},function(e){e.predicate!==u?(g=0,r.removeClass(f).removeClass(m)):(g=e.reverse===!0?2:1,r.removeClass(d[g%2]).addClass(d[g-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",["stConfig",function(e){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(t,n){return n.stTemplate?n.stTemplate:e.pagination.template},link:function(t,n,a,s){function r(){var e,n,a=s.tableState().pagination,r=1,i=t.currentPage;for(t.currentPage=Math.floor(a.start/a.number)+1,r=Math.max(r,t.currentPage-Math.abs(Math.floor(t.stDisplayedPages/2))),e=r+t.stDisplayedPages,e>a.numberOfPages&&(e=a.numberOfPages+1,r=Math.max(1,e-t.stDisplayedPages)),t.pages=[],t.numPages=a.numberOfPages,n=r;e>n;n++)t.pages.push(n);i!==t.currentPage&&t.stPageChange({newPage:t.currentPage})}t.stItemsByPage=t.stItemsByPage?+t.stItemsByPage:e.pagination.itemsByPage,t.stDisplayedPages=t.stDisplayedPages?+t.stDisplayedPages:e.pagination.displayedPages,t.currentPage=1,t.pages=[],t.$watch(function(){return s.tableState().pagination},r,!0),t.$watch("stItemsByPage",function(e,n){e!==n&&t.selectPage(1)}),t.$watch("stDisplayedPages",r),t.selectPage=function(e){e>0&&e<=t.numPages&&s.slice((e-1)*t.stItemsByPage,t.stItemsByPage)},s.tableState().pagination.number||s.slice(0,t.stItemsByPage)}}}]),e.module("smart-table").directive("stPipe",["stConfig","$timeout",function(t,n){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(a,s,r,i){var c=null;e.isFunction(a.stPipe)&&(i.preventPipeOnWatch(),i.pipe=function(){return null!==c&&n.cancel(c),c=n(function(){a.stPipe(i.tableState(),i)},t.pipe.delay)})},post:function(e,t,n,a){a.pipe()}}}}]),e.module("smart-table").directive("stRemote",["$timeout","$http",function(t,n){return{restrict:"A",require:"stTable",scope:{stRemote:"=",stTable:"="},link:function(a,s,r,i){function c(){return P?document.documentElement.scrollHeight-(window.innerHeight+window.pageYOffset):p[0].scrollHeight-(p[0].clientHeight+p[0].scrollTop)}function o(){i.slice(f.start+u.pageSize,u.pageSize)}function l(){if(v){if(f.start+u.pageSize>=S)return;f.numberOfPages=S;var e=c();m>e&&b>e&&(t.cancel(h),h=t(function(){o(),h=null},d)),b=e}}var u=e.copy(a.stRemote)||{};u.pageSize=(u.pageSize===!1?1/0:u.pageSize)||20,u.queryLabels=e.extend({page:"page",size:"size",sort:"sort",order:"order",search:"search"},u.queryLabels),u.error=u.error||function(){};var p,g=i.tableState(),f=g.pagination,m=50,d=400,h=null,b=1/0,S=1/0,v=!0,P=!1;if(u.container?"window"===u.container||"document"===u.container?(p=angular.element(window[u.container]),P=!0):p=angular.element($(u.container)):p=angular.element(s.parent()),!p)return console.error('Unable to initialise stRemote: container "'+u.container+'"" not found'),void 0;if(P||"auto"===p[0].style.overflowY||"scroll"===p[0].style.overflowY||console.log('Infinite scroll container "'+p[0]+'" may not display scroll bars'),i.preventPipeOnWatch(),i.pipe=function(){var r={};1/0!==u.pageSize&&(r.size=g&&f.number?f.number:u.pageSize,r.page=g?f.start/r.size+1:1),g.sort.predicate&&(r.sort=g.sort.predicate,r.order=g.sort.reverse?"desc":"asc"),g.search.predicateObject&&g.search.predicateObject.$&&(r.search=g.search.predicateObject.$);var i={};e.forEach(u.queryLabels,function(e,t){t in r&&(i[e]=r[t])});var l={method:"GET",url:u.url,params:i};e.isFunction(u.queryTransform)&&(l=u.queryTransform(l)),n(l).success(function(n){var i=[];u.itemsProperty?i=n[u.itemsProperty]:e.isArray(n)?i=n:e.forEach(n,function(t){e.isArray(t)&&(i=t)}),a.stTable=r.page>1?a.stTable.concat(i):i,e.isFunction(u.success)&&u.success.apply(this,arguments),i.length<r.size||1/0===u.pageSize?S=a.stTable.length:t(function(){if(i.length&&c()<m){var e=0;angular.forEach(s[0].getElementsByTagName("tr"),function(t){t.hasAttribute("ng-repeat")&&e++}),e===a.stTable.length&&o()}},0,!1)}).error(u.error)},1/0!==u.pageSize){p.bind("scroll",l);var y;window.onresize=function(){clearTimeout(y),y=setTimeout(l,d)},a.$on("stRemote.refresh",function(){i.pipe()}),a.$on("stRemote.pauseInfiniteScrolling",function(){v=!1}),a.$on("stRemote.unpauseInfiniteScrolling",function(){v=!0,l()})}i.pipe()}}}])}(angular);