/** 
* @version 2.1.1
* @license MIT
*/
!function(e,t){"use strict";e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<nav ng-if="numPages && pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></nav>')}]),e.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400,inputEvent:"input"},select:{mode:"single",selectedClass:"st-selected"},sort:{ascentClass:"st-sort-ascent",descentClass:"st-sort-descent",skipNatural:!1},pipe:{delay:100}}),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(a,n,s,r){function i(e){return e?[].concat(e):[]}function c(){b=i(l(a)),S===!0&&P.pipe()}function o(e,t){if(-1!=t.indexOf(".")){var a=t.split("."),s=a.pop(),r=a.join("."),i=n(r)(e);delete i[s],0==Object.keys(i).length&&o(e,r)}else delete e[t]}var l,u,p,g=r.stTable,f=n(g),d=f.assign,m=s("orderBy"),h=s("filter"),b=i(f(a)),v={sort:{},search:{},pagination:{start:0}},S=!0,P=this;r.stSafeSrc&&(l=n(r.stSafeSrc),a.$watch(function(){var e=l(a);return e?e.length:0},function(e){e!==b.length&&c()}),a.$watch(function(){return l(a)},function(e,t){e!==t&&c()})),this.sortBy=function(t,a){return v.sort.predicate=t,v.sort.reverse=a===!0,e.isFunction(t)?v.sort.functionName=t.name:delete v.sort.functionName,v.pagination.start=0,this.pipe()},this.search=function(t,a){var s=v.search.predicateObject||{},r=a?a:"$";return t=e.isString(t)?t.trim():t,n(r).assign(s,t),t||o(s,r),v.search.predicateObject=s,v.pagination.start=0,this.pipe()},this.pipe=function(){var e,n=v.pagination;u=v.search.predicateObject?h(b,v.search.predicateObject):b,v.sort.predicate&&(u=m(u,v.sort.predicate,v.sort.reverse)),n.number!==t&&(n.numberOfPages=u.length>0?Math.ceil(u.length/n.number):1,n.start=n.start>=u.length?(n.numberOfPages-1)*n.number:n.start,e=u.slice(n.start,n.start+parseInt(n.number))),d(a,e||u)},this.select=function(e,n){var s=i(f(a)),r=s.indexOf(e);-1!==r&&("single"===n?(e.isSelected=e.isSelected!==!0,p&&(p.isSelected=!1),p=e.isSelected===!0?e:t):s[r].isSelected=!s[r].isSelected)},this.slice=function(e,t){return v.pagination.start=e,v.pagination.number=t,this.pipe()},this.tableState=function(){return v},this.getFilteredCollection=function(){return u||b},this.setFilterFunction=function(e){h=s(e)},this.setSortFunction=function(e){m=s(e)},this.preventPipeOnWatch=function(){S=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,a,n){a.stSetFilter&&n.setFilterFunction(a.stSetFilter),a.stSetSort&&n.setSortFunction(a.stSetSort)}}}),e.module("smart-table").directive("stSearch",["stConfig","$timeout","$parse",function(e,t,a){return{require:"^stTable",link:function(n,s,r,i){var c=i,o=null,l=r.stDelay||e.search.delay,u=r.stInputEvent||e.search.inputEvent;r.$observe("stSearch",function(e,t){var a=s[0].value;e!==t&&a&&(i.tableState().search={},c.search(a,e))}),n.$watch(function(){return i.tableState().search},function(e){var t=r.stSearch||"$";e.predicateObject&&a(t)(e.predicateObject)!==s[0].value&&(s[0].value=a(t)(e.predicateObject)||"")},!0),s.bind(u,function(e){e=e.originalEvent||e,null!==o&&t.cancel(o),o=t(function(){c.search(e.target.value,r.stSearch||""),o=null},l)})}}}]),e.module("smart-table").directive("stSelectRow",["stConfig",function(e){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(t,a,n,s){var r=n.stSelectMode||e.select.mode;a.bind("click",function(){t.$apply(function(){s.select(t.row,r)})}),t.$watch("row.isSelected",function(t){t===!0?a.addClass(e.select.selectedClass):a.removeClass(e.select.selectedClass)})}}}]),e.module("smart-table").directive("stSort",["stConfig","$parse",function(a,n){return{restrict:"A",require:"^stTable",link:function(s,r,i,c){function o(){g++,u=e.isFunction(p(s))?p(s):i.stSort,g%3===0&&!!h!=!0?(g=0,c.tableState().sort={},c.tableState().pagination.start=0,c.pipe()):c.sortBy(u,g%2===0)}var l,u=i.stSort,p=n(u),g=0,f=i.stClassAscent||a.sort.ascentClass,d=i.stClassDescent||a.sort.descentClass,m=[f,d],h=i.stSkipNatural!==t?i.stSkipNatural:a.sort.skipNatural;i.stSortDefault&&(l=s.$eval(i.stSortDefault)!==t?s.$eval(i.stSortDefault):i.stSortDefault),r.bind("click",function(){u&&s.$apply(o)}),l&&(g="reverse"===l?1:0,o()),s.$watch(function(){return c.tableState().sort},function(e){e.predicate!==u?(g=0,r.removeClass(f).removeClass(d)):(g=e.reverse===!0?2:1,r.removeClass(m[g%2]).addClass(m[g-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",["stConfig",function(e){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(t,a){return a.stTemplate?a.stTemplate:e.pagination.template},link:function(t,a,n,s){function r(){var e,a,n=s.tableState().pagination,r=1,i=t.currentPage;for(t.currentPage=Math.floor(n.start/n.number)+1,r=Math.max(r,t.currentPage-Math.abs(Math.floor(t.stDisplayedPages/2))),e=r+t.stDisplayedPages,e>n.numberOfPages&&(e=n.numberOfPages+1,r=Math.max(1,e-t.stDisplayedPages)),t.pages=[],t.numPages=n.numberOfPages,a=r;e>a;a++)t.pages.push(a);i!==t.currentPage&&t.stPageChange({newPage:t.currentPage})}t.stItemsByPage=t.stItemsByPage?+t.stItemsByPage:e.pagination.itemsByPage,t.stDisplayedPages=t.stDisplayedPages?+t.stDisplayedPages:e.pagination.displayedPages,t.currentPage=1,t.pages=[],t.$watch(function(){return s.tableState().pagination},r,!0),t.$watch("stItemsByPage",function(e,a){e!==a&&t.selectPage(1)}),t.$watch("stDisplayedPages",r),t.selectPage=function(e){e>0&&e<=t.numPages&&s.slice((e-1)*t.stItemsByPage,t.stItemsByPage)},s.tableState().pagination.number||s.slice(0,t.stItemsByPage)}}}]),e.module("smart-table").directive("stPipe",["stConfig","$timeout",function(t,a){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(n,s,r,i){var c=null;e.isFunction(n.stPipe)&&(i.preventPipeOnWatch(),i.pipe=function(){return null!==c&&a.cancel(c),c=a(function(){n.stPipe(i.tableState(),i)},t.pipe.delay)})},post:function(e,t,a,n){n.pipe()}}}}]),e.module("smart-table").directive("stRemote",["$timeout","$http",function(t,a){return{restrict:"A",require:"stTable",scope:{stRemote:"=",stTable:"="},link:function(n,s,r,i){function c(){var e=g===document.body?window.innerHeight:g.clientHeight;return g.scrollHeight-(e+g.scrollTop)}function o(){i.slice(d.start+u.pageSize,u.pageSize)}function l(){if(P){if(d.start+u.pageSize>=S)return;d.numberOfPages=S;var e=c();m>e&&v>e&&(t.cancel(b),b=t(function(){o(),b=null},h)),v=e}}var u=e.copy(n.stRemote)||{};u.pageSize=(u.pageSize===!1?1/0:u.pageSize)||20,u.queryLabels=e.extend({page:"page",size:"size",sort:"sort",order:"order",search:"search"},u.queryLabels),u.error=u.error||function(){};var p,g,f=i.tableState(),d=f.pagination,m=50,h=400,b=null,v=1/0,S=1/0,P=!0;if(u.container?"window"===u.container||"document"===u.container?(p=angular.element(window[u.container]),g=document.body):(p=angular.element($(u.container)),g=p[0]):(p=angular.element(s.parent()),g=p[0]),!g)return console.error('Unable to initialise stRemote: container "'+u.container+'"" not found'),void 0;if(g!==document.body&&"auto"!==g.style.overflowY&&"scroll"!==g.style.overflowY&&console.log('Infinite scroll container "'+g+'" may not display scroll bars'),i.preventPipeOnWatch(),i.pipe=function(){var r={};1/0!==u.pageSize&&(r.size=f&&d.number?d.number:u.pageSize,r.page=f?d.start/r.size+1:1),f.sort.predicate&&(r.sort=f.sort.predicate,r.order=f.sort.reverse?"desc":"asc"),f.search.predicateObject&&f.search.predicateObject.$&&(r.search=f.search.predicateObject.$);var i={};e.forEach(u.queryLabels,function(e,t){t in r&&(i[e]=r[t])});var l={method:"GET",url:u.url,params:i};e.isFunction(u.queryTransform)&&(l=u.queryTransform(l)),a(l).success(function(a){var i=[];u.itemsProperty?i=a[u.itemsProperty]:e.isArray(a)?i=a:e.forEach(a,function(t){e.isArray(t)&&(i=t)}),n.stTable=r.page>1?n.stTable.concat(i):i,e.isFunction(u.success)&&u.success.apply(this,arguments),i.length<r.size||1/0===u.pageSize?S=n.stTable.length:t(function(){if(i.length&&c()<m){var e=0;angular.forEach(s[0].getElementsByTagName("tr"),function(t){t.hasAttribute("ng-repeat")&&e++}),e===n.stTable.length&&o()}},0,!1)}).error(u.error)},1/0!==u.pageSize){p.bind("scroll",l);var y;window.onresize=function(){clearTimeout(y),y=setTimeout(l,h)},n.$on("stRemote.pauseInfiniteScrolling",function(){P=!1}),n.$on("stRemote.unpauseInfiniteScrolling",function(){P=!0,l()})}i.pipe()}}}])}(angular);